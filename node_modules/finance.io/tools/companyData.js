'use strict';

const request = require('request');

const getUrl = (symbol, extension) => {
    if (extension === undefined || extension === '') {
        extension = '';
    } else {
        extension = `.${extension}`;
    }
    let url = `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${symbol}${extension}?&modules=assetProfile`;
    return url;
};

const getJson = url =>
    new Promise((resolve, reject) => {
        let requestOpts = {
            url: url,
            json: true,
            headers: { 'User-agent': 'request' },
        };

        request.get(requestOpts, (err, res, data) => {
            if (err) {
                reject(err);
            } else if (res.statusCode !== 200) {
                reject(res.statusCode);
            } else {
                resolve(data);
            }
        });
    });

const companyData = (symbol, extension) =>
    new Promise((resolve, reject) => {
        let url = getUrl(symbol, extension);
        getJson(url)
            .then(data => {
              const dt = data.quoteSummary.result[0].assetProfile
                resolve({
                    symbol,
                    data : "Company Information",
                 address1: dt.address1, city : dt.city, state : dt.state, zipCode : dt.zip, country: dt.country, contactNumber : dt.phone, website : dt.website, industry : dt.industry, sector: dt.sector, businessSummary : dt.longBusinessSummary, fullTimeEmployees : dt.fullTimeEmployees, headCompanyOfficers : dt.companyOfficers[0].name,
                });
            })
            .catch(err => {
                reject(err);
            });
    });

module.exports = companyData